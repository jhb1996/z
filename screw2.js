448),n(1543),n(1547),n(1548),n(1549),n(1560),n(1561)},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(n(1544)),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1546));const a=e=>{};window.addEventListener("scroll",(0,r.default)(500)(()=>browser.runtime.sendMessage({funcName:"updateScrollState",scrollOffset:i.fetchScrollOffset(),windowHeight:i.fetchWindowHeight(),scrollableHeight:i.fetchScrollableHeight()}).catch(a)))},function(e,t,n){var r=n(44)("throttle",n(1545));r.placeholder=n(32),e.exports=r},function(e,t,n){var r=n(376),i=n(13),a="Expected a function";e.exports=function(e,t,n){var o=!0,s=!0;if("function"!=typeof e)throw new TypeError(a);return i(n)&&(o="leading"in n?!!n.leading:o,s="trailing"in n?!!n.trailing:s),r(e,t,{leading:o,maxWait:t,trailing:s})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.fetchScrollableHeight=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)||null},t.fetchScrollOffset=(()=>void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop),t.fetchWindowHeight=(()=>window.innerHeight||document.documentElement.clientHeight)},function(e,t,n){"use strict";var r=n(6),i=function(e){return e&&e.__esModule?e:{default:e}}(n(1044));(0,r.makeRemotelyCallable)({extractPageContent:i.default})},function(e,t,n){"use strict";let r=(()=>{var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(i,a){try{var o=t[i](a),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getLocalStorage(i.SEARCH_INJECTION_KEY,i.SEARCH_INJECTION_DEFAULT);case 2:if(t=e.sent,!c||!t[c]){e.next=14;break}return e.prev=4,n=a.fetchQuery(l),e.next=8,u({query:n,limit:5});case 8:((r=e.sent).docs.length||r.requiresMigration)&&(0,o.handleRender)(r,c),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(4);case 14:case"end":return e.stop()}},e,this,[[4,12]])}));return function(){return e.apply(this,arguments)}})();var i=s(n(156)),a=s(n(408)),o=n(710);function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}const u=(0,n(6).remoteFunction)("search"),l=window.location.href,c=a.matchURL(l);r()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;let r=t.init=(()=>{var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(i,a){try{var o=t[i](a),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.bodyLoader)();case 2:return(t=document.createElement("div")).setAttribute("id","memex-direct-linking-tooltip"),document.body.appendChild(t),n=browser.extension.getURL("/content_script.css"),(0,l.injectCSS)(n),e.next=9,(0,s.setupUIContainer)(t,{createAndCopyDirectLink:o.createAndCopyDirectLink,createAnnotation:o.createAnnotation,openSettings:function(){return c("settings")},destroyTooltip:function(){u.destroyTooltipTrigger(),(0,s.destroyUIContainer)(t),t.remove()}});case 9:r=e.sent,u.setupTooltipTrigger(r),u.conditionallyTriggerTooltip(r);case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}})();var i=n(6),a=n(1330),o=n(1550),s=n(1552),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1559)),l=n(710);const c=(0,i.remoteFunction)("openOptionsTab");r()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createAnnotation=t.createAndCopyDirectLink=void 0;t.createAndCopyDirectLink=(()=>{var e=s(regeneratorRuntime.mark(function e(){var t,n,o,s,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getSelection(),n=t.getRangeAt(0),o=window.location.href,e.next=5,r(t);case 5:return s=e.sent,e.next=8,(0,i.remoteFunction)("createDirectLink")({url:o,anchor:s});case 8:return l=e.sent,(0,a.copyToClipboard)(l.url),u(n),e.abrupt("return",l);case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}})(),t.createAnnotation=(()=>{var e=s(regeneratorRuntime.mark(function e(){var t,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getSelection(),n=t.getRangeAt(0),e.next=4,r(t);case 4:return a=e.sent,e.next=7,(0,i.remoteFunction)("openSidebarWithHighlight")(a);case 7:u(n);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}})();let r=(()=>{var e=s(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.toString(),e.next=3,o.selectionToDescriptor({selection:t});case 3:return r=e.sent,e.abrupt("return",{quote:n,descriptor:r});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}})();var i=n(6),a=n(1551),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(725));function s(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(i,a){try{var o=t[i](a),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}function u(e){const t=document.getSelection();t.removeAllRanges(),t.addRange(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.copyToClipboard=(e=>{const t=document.createElement("input");document.body.appendChild(t),t.setAttribute("value",e),t.select();const n=document.execCommand("copy");return document.body.removeChild(t),n})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setupUIContainer=function(e,t){let n=t.createAndCopyDirectLink,o=t.openSettings,s=t.destroyTooltip,u=t.createAnnotation;return new Promise(t=>{i.default.render(r.default.createElement(a.default,{onInit:e=>t(e),destroy:s,createAndCopyDirectLink:n,createAnnotation:u,openSettings:o}),e)})},t.destroyUIContainer=function(e){i.default.unmountComponentAtNode(e)};var r=o(n(1)),i=o(n(60)),a=o(n(1553));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(1)),i=u(n(2)),a=u(n(352)),o=u(n(1554)),s=n(1558);function u(e){return e&&e.__esModule?e:{default:e}}function l(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(i,a){try{var o=t[i](a),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}class c extends r.default.Component{constructor(){var e;e=super(...arguments),this.state={showTooltip:!1,position:{x:250,y:200},tooltipState:"copied"},this.showTooltip=(e=>{"running"!==this.state.tooltipState&&this.setState({showTooltip:!0,position:e,tooltipState:"pristine"})}),this.handleClickOutside=(()=>{this.setState({showTooltip:!1,position:{}})}),this.closeTooltip=(e=>{e.preventDefault(),e.stopPropagation(),this.props.destroy()}),this.createLink=l(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({tooltipState:"running"}),t.next=3,e.props.createAndCopyDirectLink();case 3:e.setState({tooltipState:"copied"});case 4:case"end":return t.stop()}},t,e)})),this.createAnnotation=(()=>{var t=l(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),n.stopPropagation(),t.next=4,e.props.createAnnotation();case 4:setTimeout(function(){e.setState({tooltipState:"runnning",showTooltip:!1,position:{}})},400);case 5:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}})(),this.openSettings=(e=>{e.preventDefault(),this.props.openSettings()}),this.renderTooltipComponent=(()=>{switch(this.state.tooltipState){case"pristine":return r.default.createElement(s.InitialComponent,{createLink:this.createLink,createAnnotation:this.createAnnotation});case"running":return r.default.createElement(s.CreatingLinkComponent,null);case"copied":return r.default.createElement(s.CopiedComponent,null);case"done":return r.default.createElement(s.DoneComponent,null);default:return r.default.createElement(s.ErrorComponent,null)}})}componentDidMount(){this.props.onInit(this.showTooltip)}render(){var e=this.state;const t=e.showTooltip,n=e.position,i=e.tooltipState;return r.default.createElement("div",{className:"memex-tooltip-container"},t?r.default.createElement(o.default,Object.assign({},n,{state:i,tooltipComponent:this.renderTooltipComponent(),closeTooltip:this.closeTooltip,openSettings:this.openSettings})):null)}}c.propTypes={onInit:i.default.func.isRequired,createAndCopyDirectLink:i.default.func.isRequired,createAnnotation:i.default.func.isRequired,openSettings:i.default.func.isRequired,destroy:i.default.func.isRequired},t.default=(0,a.default)(c)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(1)),i=l(n(2)),a=l(n(5)),o=l(n(1555)),s=n(709),u=l(n(1331));function l(e){return e&&e.__esModule?e:{default:e}}const c={cross:(0,s.getExtURL)("/img/cross_grey.svg"),settings:(0,s.getExtURL)("/img/settings_grey.svg")},d=e=>{let t=e.x,n=e.y,i=e.state,s=e.tooltipComponent,l=e.closeTooltip,d=e.openSettings;return r.default.createElement("div",{className:(e=>(0,a.default)(u.default.tooltip,{[u.default.statePristine]:"pristine"===e,[u.default.stateCopied]:"copied"===e}))(i),style:{left:t,top:n},id:"memex-tooltip"},r.default.createElement(o.default,null,s),r.default.createElement("span",{className:u.default.buttons},r.default.createElement("a",{onClick:l,className:u.default.smallButton},r.default.createElement("img",{className:u.default.imgCross,src:c.cross,title:"Close once. Disable via Memex icon in the extension toolbar."})),r.default.createElement("a",{onClick:d,className:u.default.smallButton},r.default.createElement("img",{className:u.default.imgSettings,src:c.settings}))))};d.propTypes={x:i.default.number.isRequired,y:i.default.number.isRequired,state:i.default.string.isRequired,tooltipComponent:i.default.element.isRequired,closeTooltip:i.default.func.isRequired,openSettings:i.default.func.isRequired},t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(1)),i=o(n(2)),a=o(n(1331));function o(e){return e&&e.__esModule?e:{default:e}}class s extends r.default.Component{constructor(){super(...arguments),this.setRef=(e=>this.container=e)}render(){return r.default.createElement("div",{ref:this.setRef,className:a.default.animationContainer},this.props.children)}}s.propTypes={children:i.default.node.isRequired},t.default=s},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorComponent=t.DoneComponent=t.CopiedComponent=t.CreatingLinkComponent=t.InitialComponent=void 0;var r=s(n(1)),i=s(n(2)),a=s(n(1331)),o=n(709);function s(e){return e&&e.__esModule?e:{default:e}}const u={share:(0,o.getExtURL)("/img/share.svg"),check:(0,o.getExtURL)("/img/green_check.svg"),annotate:(0,o.getExtURL)("/img/annotate.svg")};(t.InitialComponent=(e=>{let t=e.createLink,n=e.createAnnotation;return r.default.createElement("div",{className:a.default.createButtons},r.default.createElement("div",{title:"Add note to highlight",className:a.default.annotateButton,onMouseDown:n},r.default.createElement("span",{className:a.default.annotateIcon})),r.default.createElement("div",{title:"Share a link to this highlight",className:a.default.linkButton,onMouseDown:t},r.default.createElement("span",{className:a.default.shareIcon})))})).propTypes={createLink:i.default.func.isRequired,createAnnotation:i.default.func.isRequired};t.CreatingLinkComponent=(()=>r.default.createElement("div",{className:a.default.progressIndicator},r.default.createElement("div",{className:a.default.ldsEllipsis},r.default.createElement("div",null),r.default.createElement("div",null),r.default.createElement("div",null),r.default.createElement("div",null)))),t.CopiedComponent=(()=>r.default.createElement("div",{className:a.default.copiedMessage},r.default.createElement("img",{className:a.default.check,src:u.check}),r.default.createElement("div",{className:a.default.copiedTextContainer},r.default.createElement("p",{className:a.default.greenText},"Highlight link copied to clipboard"),r.default.createElement("p",{className:a.default.greyText},"Everyone opening it can see this quote")))),t.DoneComponent=(()=>r.default.createElement("div",{className:a.default.doneComponent},r.default.createElement("img",{className:a.default.check,src:u.check}))),t.ErrorComponent=(()=>r.default.createElement("div",{className:a.default.errorMessage},"Error"))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.conditionallyTriggerTooltip=void 0,t.setupTooltipTrigger=function(e){i=(t=>{a(e,t)}),document.body.addEventListener("mouseup",i)},t.destroyTooltipTrigger=function(){document.body.removeEventListener("mouseup",i),i=null};var r=n(709);let i=null;const a=t.conditionallyTriggerTooltip=(0,r.delayed)((()=>{var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(i,a){try{var o=t[i](a),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}(regeneratorRuntime.mark(function e(t,n){var i,a,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.getTooltipState)();case 2:if(i=e.sent,s()&&i&&(!n||!u(n))){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,(0,r.getPositionState)();case 7:"text"!==(a=e.sent)&&n?"mouse"===a&&n&&(l={x:n.pageX,y:n.pageY}):l=o(),t(l);case 10:case"end":return e.stop()}},e,void 0)}));return function(t,n){return e.apply(this,arguments)}})(),300);function o(){const e=document.getSelection().getRangeAt(0).getBoundingClientRect();return{x:e.left+e.width/2,y:window.pageYOffset+e.top+e.height-10}}function s(){const e=document.getSelection();if("None"===e.type)return!1;const t=e.toString().trim(),n=function(e){let t=e.parentElement;for(;t;){if("true"===t.contentEditable||"A"===t.nodeName)return!0;t=t.parentElement}return!1}(e.getRangeAt(0).commonAncestorContainer);return!(!e||e.isCollapsed||!t||n)}function u(e){const t=document.querySelector("#memex-direct-linking-tooltip");return!t||t.contains(e.target)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;let r=t.init=(()=>{var e=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.bodyLoader)();case 2:setTimeout(function(){(0,a.remoteFunction)("followAnnotationRequest")()},500);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}})();t.setupAnchorFallbackOverlay=c;var i=n(1330),a=n(6),o=u(n(726)),s=u(n(409));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function l(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(i,a){try{var o=t[i](a),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}function c(){}browser.runtime.onMessage.addListener(e=>{"direct-link"===e.type&&l(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.highlightAnnotation({annotation:e.annotation});case 2:t.sent&&(s.makeHighlightDark(e.annotation),s.scrollToHighlight(e.annotation));case 4:case"end":return t.stop()}},t,void 0)}))()}),r()},function(e,t,n){"use strict";var r=n(1330),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(409)),a=n(719),o=n(566);const s=e=>{"m"===e.key&&i.insertRibbon()};(()=>{var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(i,a){try{var o=t[i](a),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.setupRPC(),e.next=3,(0,a.getLocalStorage)(o.TOOLTIP_STORAGE_NAME,!0);case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,(0,r.interactiveLoader)();case 8:return document.addEventListener("keydown",s,!1),e.next=11,(0,r.bodyLoader)();case 11:if(document.removeEventListener("keydown",s,!1),t=document.querySelectorAll("input[type=password]"),!(t.length>0)){e.next=16;break}return e.abrupt("return");case 16:i.insertRibbon();case 17:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}})()()}]);